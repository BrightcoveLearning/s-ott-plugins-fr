<h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <section class="bcls-section">
    <aside class="bcls-aside bcls-aside--information language-editable">This document is one part of the OTT Plugins document collection. Since OTT Plugins are implemented using JavaScript and CSS, the target audience for this document is developers with some experience with both of those technologies. To learn more about OTT Plugins see the <a href="/ott-plugins/index.html">OTT Plugins documentation home page</a>.</aside>
    <h2 id="Introduction">Introduction</h2>
    <p>The {{ site.product_short }} web apps allow you to add some of your own customizations. For example, you can create a JavaScript plugin to listen for web page events and process custom code based on your requirements. For details, see the <a href="/ott-plugins/index.html">OTT Plugins</a> documents.</p>
    <p>Beacon page events are triggered by user interactions with the {{ site.product_short }} app. This diagram shows the relationship between the user, your {{ site.product_short }} web app and your plugin code.</p>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Beacon page events" src="/assets/images/s-ott-plugins-img/page-events/page-event-diagram.svg" />
      <figcaption class="bcls-caption--image">Beacon page events</figcaption>
    </figure>
    <!-- <div style="position: relative; display: block; max-width: 960px;">
      <div style="padding-top: 56.25%;"><iframe src="https://players.brightcove.net/1507807800001/default_default/index.html?videoId=6293553909001" allowfullscreen="" allow="encrypted-media" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; width: 100%; height: 100%;"></iframe></div>
    </div> -->
    <h3>Use cases</h3>
    <p>Here are some use cases when listening to page events:</p>
    <ul>
      <li><code translate="No">onBeaconPageLoad</code> - When this event is triggered, you can add custom buttons, populate custom sections, and create custom pages for your {{ site.product_short }} web app</li>
      <li><code translate="No">loadedBeaconVideoMetadata</code> - When this event is triggered, you can display data for the current video in your {{ site.product_short }} web app</li>
    </ul>
  </section>

  <section class="bcls-section">
    <h2 id="Event_listeners">Event listeners</h2>
    <p>The following page events can be listened for by your OTT plugin code:</p>
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Event</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">beforeBeaconPageLoad</code></td>
          <td>Called before the page starts to load all of the required elements. This includes the API calls to fetch asset and playlist details</td>
        </tr>
        <tr>
          <td><code translate="No">onBeaconPageLoad</code></td>
          <td>Called when all of the required elements to render the page are available and all checks are complete (entitlements, episodes list, etc)</td>
        </tr>
        <tr>
          <td><code translate="No">onBeaconPageChange</code></td>
          <td>Called when there is a change on the {{ site.product_short }} web app page. For example, when you are watching a video on the details page, and select a new series, season or episode. For the Live TV page, it is also called when the selected linear channel changes.</td>
        </tr>
        <tr>
          <td><code translate="No">loadedBeaconVideoMetadata</code></td>
          <td>Called when the metadata for the current video has been loaded</td>
        </tr>
        <tr>
          <td><code translate="No">onBeaconPageUnload</code></td>
          <td>Called after the <code translate="No">destroy()</code> from the superclass finishes</td>
        </tr>
      </tbody>
    </table>
    <!-- <aside class="bcls-aside bcls-aside--information">When a user has a details page for a series open, and a new season/episode is selected, the previously added button will not be removed. </aside> -->
  </section>

  <section class="bcls-section">
    <h2 id="Event_data">Event data</h2>
    <p>When listening to page events, you can display the event data which is available for use in your custom code.</p>
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Data element</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">page_type</code></td>
          <td>enum</td>
          <td>A unique page type for the current page being viewed. Values:
            <ul>
              <li><code translate="No">about</code></li>
              <li><code translate="No">bookmarks</code></li>
              <li><code translate="No">change_language</code></li>
              <li><code translate="No">custom_screen</code></li>
              <li><code translate="No">details</code></li>
              <li><code translate="No">device_management</code></li>
              <li><code translate="No">edit_profile</code></li>
              <li><code translate="No">epg</code></li>
              <li><code translate="No">favorites</code></li>
              <li><code translate="No">landing_page</code></li>
              <li><code translate="No">live_event_details</code></li>
              <li><code translate="No">live_event_player</code></li>
              <li><code translate="No">livetv</code></li>
              <li><code translate="No">manage_subscriptions</code></li>
              <li><code translate="No">my_account</code></li>
              <li><code translate="No">parental_controls</code></li>
              <li><code translate="No">payments</code></li>
              <li><code translate="No">player_live</code></li>
              <li><code translate="No">playlist_view_all</code></li>
              <li><code translate="No">player_vod</code></li>
              <li><code translate="No">profiles_list</code></li>
              <li><code translate="No">purchased</code></li>
              <li><code translate="No">screen</code></li>
              <li><code translate="No">search</code></li>
              <li><code translate="No">settings</code></li>
              <li><code translate="No">static_page</code></li>
              <li><code translate="No">transactions</code></li>
            </ul>
          </td>
        </tr>
        <tr>
          <td><code translate="No">slug</code></td>
          <td>string</td>
          <td>A unique id for your custom page</td>
        </tr>
        <tr>
          <td><code translate="No">asset_id</code></td>
          <td>integer</td>
          <td>Sent in the event object for these pages:
            <ul>
              <li><code translate="No">details</code></li>
              <li><code translate="No">player_vod</code></li>
              <li><code translate="No">player_live</code></li>
            </ul>
          </td>
        </tr>
        <tr>
          <td><code translate="No">playlist_id</code></td>
          <td>integer</td>
          <td>Sent in the event object for the <code translate="No">playlist_view_all</code> page
          </td>
        </tr>
        <tr>
          <td><code translate="No">page_id</code></td>
          <td>integer</td>
          <td>Sent in the event object for the <code translate="No">home</code> page
          </td>
        </tr>
        <tr>
          <td><code translate="No">bc_account_id</code></td>
          <td>integer</td>
          <td>Sent in the <code translate="No">loadedBeaconVideoMetadata</code> event</td>
        </tr>
        <tr>
          <td><code translate="No">device</code></td>
          <td>string</td>
          <td><code translate="No">'web'</code></td>
        </tr>
        <tr>
          <td><code translate="No">video_id</code></td>
          <td>integer</td>
          <td>Sent in the <code translate="No">loadedBeaconVideoMetadata</code> event</td>
        </tr>
        <tr>
          <td><code translate="No">user_language</code></td>
          <td>string</td>
          <td>The language code for the current language from the Beacon API</td>
        </tr>
        <tr>
          <td><code translate="No">entitlements</code></td>
          <td>boolean</td>
          <td>Displays whether the content is free or if the user is entitled to see the content</td>
        </tr>

      </tbody>
    </table>
    <h3>Examples</h3>
    <p>Here are some examples of actual page event data:</p>
    <h3><code translate="No">beforeBeaconPageLoad</code></h3>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Before Beacon page load" src="/assets/images/s-ott-plugins-img/page-events/before-beacon-page-load.png" />
      <figcaption class="bcls-caption--image">Before Beacon page load</figcaption>
    </figure>

    <h3><code translate="No">onBeaconPageLoad</code></h3>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="On Beacon page load" src="/assets/images/s-ott-plugins-img/page-events/beacon-page-load.png" />
      <figcaption class="bcls-caption--image">On Beacon page load</figcaption>
    </figure>

    <h3><code translate="No">loadedBeaconVideoMetadata</code></h3>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Loaded Beacon page load" src="/assets/images/s-ott-plugins-img/page-events/beacon-video-metadata.png" />
      <figcaption class="bcls-caption--image">Loaded Beacon page load</figcaption>
    </figure>

    <h3><code translate="No">onBeaconPageChange</code></h3>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Beacon page change" src="/assets/images/s-ott-plugins-img/page-events/beacon-page-change.png" />
      <figcaption class="bcls-caption--image">Beacon page change</figcaption>
    </figure>

    <h3><code translate="No">onBeaconPageUnload</code></h3>
    <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Beacon page unloaded" src="/assets/images/s-ott-plugins-img/page-events/beacon-page-unload.png" />
      <figcaption class="bcls-caption--image">Beacon page unloaded</figcaption>
    </figure>

  </section>

  <section class="bcls-section">
    <h2 id="Module_implementation">Module implementation</h2>
    <p>The following shows how to listen to {{ site.product_short }} web page events. For some customization examples, see the <a href="/ott-plugins/index.html">OTT Plugins</a> documents.</p>
    <p>While our examples use JavaScript modules, you may implement your JavaScript in the manner of your choice. Further details on this module implementation can be found in the <a href="">Implementing OTT Plugin Code Using Modules</a> document.</p>

    <h3><code translate="No">index.js</code></h3>
    <p>Here is our example code:</p>
    <pre class="line-numbers"><code class="language-javascript" translate="No">window.addEventListener(&quot;message&quot;, (event) =&gt; {
  const originsAllowed = [
    &apos;<span class="bcls-input">your {{ site.product_short }} app URL</span>&apos;
  ];
  if (originsAllowed.includes(event.origin)) {

    switch (event.data.event) {
      case &apos;beforeBeaconPageLoad&apos;:
        console.log(&apos;beforeBeaconPageLoad Event data: &apos;, event.data.data);
        break;

      case &apos;onBeaconPageLoad&apos;:
        console.log(&apos;onBeaconPageLoad Event data: &apos;, event.data.data);
        break;   
        
      case &apos;loadedBeaconVideoMetadata&apos;:
        console.log(&apos;loadedBeaconVideoMetadata Event data: &apos;, event.data.data);
      break;

      case &apos;onBeaconPageChange&apos;:
        console.log(&apos;onBeaconPageChange Event data: &apos;, event.data.data);
      break;

      case &apos;onBeaconPageUnload&apos;:
        console.log(&apos;onBeaconPageUnload Event data: &apos;, event.data.data);
      break;
    }
  }
},
false
);</code></pre>

    <!-- <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Event</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">detailsPageExternalButtonWasClicked</code></td> 
          <td>Listen for this event. When triggered, do the following:
            <ul>
              <li>Check the code translate="No">event.data.data.element_id</code> to determine which button was clicked</li>
              <li>Call the <strong>handleButtonClick</strong> function with the button value.</li>
            </ul> 
          </td>
        </tr>
        <tr>
          <td><code translate="No">onBeaconPageLoad</code></td>
          <td>Listen for this event. When triggered, do the following:
            <ul>
              <li>Call the <strong>addCustomButtonDetailsParams</strong> function to add the Download button.</li>
              <li>Call the <strong>addCustomButtonDetailsParams</strong> function to add the Location button.</li>
            </ul> 
          </td>
        </tr>
       
      </tbody>
    </table> -->
  </section>

</article>